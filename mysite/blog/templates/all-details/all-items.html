{% extends "base.html" %}
{% load static %}
{% load tailwind_filters %}
{% block title %}Marketplace - Browse Items{% endblock  %}
{% block content %}
    {% include "partials/nav.html" %}

    <!-- Mobile-First Marketplace -->
    <div class="min-h-screen bg-gray-50">
        <!-- Sticky Header -->
        <div class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-20">
            <div class="max-w-7xl mx-auto px-4 py-3">
                <!-- Mobile Header -->
                <div class="flex items-center justify-between md:hidden">
                    <!-- Back Button -->
                    <button onclick="goBack()" 
                            class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100 active:scale-95 transition-all">
                        <i class="fa-solid fa-arrow-left text-gray-600"></i>
                    </button>
                    
                    <!-- Title -->
                    <div class="flex-1 text-center">
                        <h1 class="text-lg font-semibold text-gray-900">Marketplace</h1>
                        <p class="text-xs text-gray-500">{{ items|length }} items</p>
                    </div>
                    
                    <!-- Filter Button -->
                    <button id="filter-toggle"
                            class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100 active:scale-95 transition-all">
                        <i class="fa-solid fa-sliders text-gray-600"></i>
                    </button>
                </div>
                
                <!-- Desktop Header -->
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Marketplace</h1>
                        <p class="text-gray-600 mt-1">Discover great deals and unique items</p>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <button onclick="goBack()" 
                                class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            <i class="fa-solid fa-arrow-left mr-2"></i>
                            Back
                        </button>
                        
                        <!-- Add New Item Button -->
                        <button type="button" 
                                data-modal-target="add-item-modal" 
                                data-modal-toggle="add-item-modal"
                                class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-teal-500 to-cyan-500 rounded-lg hover:from-teal-600 hover:to-cyan-600 transition-all shadow-sm">
                            <i class="fa-solid fa-plus mr-2"></i>
                            Sell Item
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 py-4 md:py-6">
            <!-- Filter Section (Collapsible on Mobile) -->
            <div id="filter-section" class="hidden md:block bg-white rounded-xl shadow-sm border border-gray-200 mb-6 p-4">
                <div class="flex flex-wrap items-center gap-4">
                    <!-- Search -->
                    <div class="flex-1 min-w-[200px]">
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fa-solid fa-search text-gray-400"></i>
                            </div>
                            <input type="text" 
                                   placeholder="Search items..." 
                                   class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                        </div>
                    </div>
                    
                    <!-- Category Filter -->
                    <div>
                        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 block w-full p-2.5">
                            <option selected>All Categories</option>
                            <option value="electronics">Electronics</option>
                            <option value="fashion">Fashion</option>
                            <option value="home">Home & Garden</option>
                            <option value="vehicles">Vehicles</option>
                            <option value="property">Property</option>
                        </select>
                    </div>
                    
                    <!-- Price Range -->
                    <div>
                        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 block w-full p-2.5">
                            <option selected>Price Range</option>
                            <option value="0-100">Under GHS 100</option>
                            <option value="100-500">GHS 100 - 500</option>
                            <option value="500-1000">GHS 500 - 1000</option>
                            <option value="1000+">Above GHS 1000</option>
                        </select>
                    </div>
                    
                    <!-- Location -->
                    <div>
                        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 block w-full p-2.5">
                            <option selected>All Locations</option>
                            <option value="accra">Accra</option>
                            <option value="kumasi">Kumasi</option>
                            <option value="tema">Tema</option>
                            <option value="takoradi">Takoradi</option>
                        </select>
                    </div>
                    
                    <!-- Sort By -->
                    <div>
                        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 block w-full p-2.5">
                            <option selected>Sort By</option>
                            <option value="newest">Newest First</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="popular">Most Popular</option>
                        </select>
                    </div>
                    
                    <!-- Apply Filters Button -->
                    <button class="px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors">
                        Apply Filters
                    </button>
                </div>
            </div>

            <!-- Items Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6">
                {% for item in items %}
                <div class="group bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-all duration-300 active:scale-[0.98] md:active:scale-100">
                    <!-- Item Image -->
                    <div class="relative aspect-square overflow-hidden bg-gray-100">
                        {% if item.image %}
                            <img src="{{ item.image.url }}" 
                                 class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                                 alt="{{ item.title }}"
                                 loading="lazy">
                        {% else %}
                            <div class="w-full h-full flex items-center justify-center">
                                <div class="text-center">
                                    <i class="fa-solid fa-image text-gray-300 text-4xl mb-2"></i>
                                    <p class="text-gray-400 text-sm">No Image</p>
                                </div>
                            </div>
                        {% endif %}
                        
                        <!-- Status Badge -->
                        <div class="absolute top-3 left-3">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium {% if item.item_status == 'Available' %}bg-green-100 text-green-800{% elif item.item_status == 'Sold' %}bg-red-100 text-red-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ item.item_status|default:"Available" }}
                            </span>
                        </div>
                        
                        <!-- Delete Button (Owner Only) -->
                        {% if item.user == request.user %}
                        <div class="absolute top-3 right-3">
                            <a href="{% url 'delete-item' item.id %}" 
                               class="flex items-center justify-center w-8 h-8 bg-white/90 backdrop-blur-sm rounded-full shadow-md hover:bg-white hover:shadow-lg transition-all active:scale-95"
                               onclick="return confirm('Are you sure you want to delete this item?');">
                                <i class="fa-solid fa-trash-can text-rose-600 text-xs"></i>
                            </a>
                        </div>
                        {% endif %}
                        
                        <!-- Quick View Overlay -->
                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                            <a href="{% url 'item-detail' item.id %}"
                               class="flex items-center justify-center px-4 py-2 bg-white text-gray-900 text-sm font-medium rounded-lg hover:bg-gray-50 transition-colors shadow-lg">
                                <i class="fa-solid fa-eye mr-2"></i>
                                Quick View
                            </a>
                        </div>
                    </div>
                    
                    <!-- Item Info -->
                    <div class="p-3 md:p-4">
                        <!-- Price -->
                        <div class="flex items-center justify-between mb-2">
                            <div class="text-lg font-bold text-teal-600">
                                GHS {{ item.price }}
                            </div>
                            <div class="flex items-center text-xs text-gray-500">
                                <i class="fa-solid fa-eye mr-1"></i>
                                <span>45</span>
                            </div>
                        </div>
                        
                        <!-- Title -->
                        <h3 class="text-sm font-semibold text-gray-900 mb-2 line-clamp-1">
                            {{ item.title }}
                        </h3>
                        
                        <!-- Description -->
                        <p class="text-xs text-gray-600 mb-3 line-clamp-2">
                            {{ item.content|truncatewords:15 }}
                        </p>
                        
                        <!-- Location -->
                        <div class="flex items-center text-xs text-gray-500 mb-4">
                            <i class="fa-solid fa-location-dot mr-1.5 flex-shrink-0"></i>
                            <span class="truncate">{{ item.location }}</span>
                        </div>
                        
                        <!-- Tags & Actions -->
                        <div class="flex items-center justify-between pt-3 border-t border-gray-100">
                            <!-- Tags -->
                            <div class="flex items-center gap-1 overflow-hidden">
                                {% if item.item_type %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-800 border border-gray-200 whitespace-nowrap truncate max-w-[100px]">
                                    {{ item.item_type }}
                                </span>
                                {% endif %}
                                <span class="text-xs text-gray-400">
                                    {{ item.date_posted|timesince }} ago
                                </span>
                            </div>
                            
                            <!-- View Button -->
                            <a href="{% url 'item-detail' item.id %}"
                               class="inline-flex items-center text-xs font-medium text-teal-600 hover:text-teal-700 transition-colors whitespace-nowrap">
                                View Details
                                <i class="fa-solid fa-arrow-right ml-1 text-xs"></i>
                            </a>
                        </div>
                    </div>
                </div>
                {% empty %}
                <!-- Empty State -->
                <div class="col-span-full text-center py-12 md:py-16">
                    <div class="max-w-md mx-auto px-4">
                        <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gray-100 flex items-center justify-center">
                            <i class="fa-solid fa-box-open text-gray-400 text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">No items found</h3>
                        <p class="text-gray-600 mb-6">Be the first to list an item in the marketplace</p>
                        <button type="button" 
                                data-modal-target="add-item-modal" 
                                data-modal-toggle="add-item-modal"
                                class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-teal-500 to-cyan-500 text-white text-sm font-medium rounded-lg hover:from-teal-600 hover:to-cyan-600 transition-all shadow-lg">
                            <i class="fa-solid fa-plus mr-2"></i>
                            List Your First Item
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Load More / Pagination -->
            {% if items.has_other_pages %}
            <div class="mt-8 flex justify-center">
                <nav class="inline-flex rounded-md shadow-sm -space-x-px">
                    {% if items.has_previous %}
                    <a href="?page={{ items.previous_page_number }}"
                       class="inline-flex items-center px-3 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                        <i class="fa-solid fa-chevron-left mr-1"></i>
                        Previous
                    </a>
                    {% endif %}
                    
                    {% for i in items.paginator.page_range %}
                        {% if items.number == i %}
                        <span class="inline-flex items-center px-4 py-2 border border-teal-500 bg-teal-50 text-sm font-medium text-teal-600">
                            {{ i }}
                        </span>
                        {% else %}
                        <a href="?page={{ i }}"
                           class="inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                            {{ i }}
                        </a>
                        {% endif %}
                    {% endfor %}
                    
                    {% if items.has_next %}
                    <a href="?page={{ items.next_page_number }}"
                       class="inline-flex items-center px-3 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                        Next
                        <i class="fa-solid fa-chevron-right ml-1"></i>
                    </a>
                    {% endif %}
                </nav>
            </div>
            {% endif %}
        </main>

        <!-- Floating Action Button (Mobile Only) -->
        <div class="md:hidden fixed bottom-6 right-6 z-30">
            <button type="button" 
                    data-modal-target="add-item-modal" 
                    data-modal-toggle="add-item-modal"
                    class="flex items-center justify-center w-14 h-14 bg-gradient-to-r from-teal-500 to-cyan-500 text-white rounded-full shadow-xl hover:shadow-2xl hover:scale-105 active:scale-95 transition-all duration-300 group">
                <i class="fa-solid fa-plus text-lg"></i>
                <span class="absolute -top-8 right-0 bg-gray-900 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                    Sell Item
                </span>
            </button>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div id="add-item-modal" tabindex="-1" aria-hidden="true" 
         class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative p-3 sm:p-4 w-full max-w-2xl max-h-full">
            <!-- Modal content -->
            <div class="relative bg-white rounded-xl shadow-lg md:rounded-2xl">
                <!-- Modal header -->
                <div class="flex items-center justify-between p-4 md:p-6 border-b border-gray-200 rounded-t-xl md:rounded-t-2xl bg-gradient-to-r from-teal-50 to-cyan-50">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 w-10 h-10 rounded-full bg-teal-100 flex items-center justify-center mr-3">
                            <i class="fa-solid fa-plus text-teal-600"></i>
                        </div>
                        <div>
                            <h3 class="text-lg md:text-xl font-semibold text-gray-900">
                                List New Item
                            </h3>
                            <p class="text-xs md:text-sm text-gray-600">Sell your item in the marketplace</p>
                        </div>
                    </div>
                    <button type="button" 
                            class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center transition-all active:scale-95"
                            data-modal-hide="add-item-modal">
                        <i class="fa-solid fa-times"></i>
                        <span class="sr-only">Close modal</span>
                    </button>
                </div>
                
                <!-- Modal body -->
                <div class="p-4 md:p-6 space-y-4 max-h-[60vh] overflow-y-auto">
                    <form method="post" enctype="multipart/form-data" class="space-y-6">
                        {% csrf_token %}
                        
                        <!-- Form fields would go here -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Item Title -->
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Item Title *
                                </label>
                                <input type="text" 
                                       name="title"
                                       required
                                       placeholder="What are you selling?"
                                       class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm">
                            </div>
                            
                            <!-- Price -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Price (GHS) *
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <span class="text-gray-500">GHS</span>
                                    </div>
                                    <input type="number" 
                                           name="price"
                                           required
                                           min="0"
                                           step="0.01"
                                           placeholder="0.00"
                                           class="w-full pl-12 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm">
                                </div>
                            </div>
                            
                            <!-- Category -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Category *
                                </label>
                                <select name="item_type"
                                        required
                                        class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm">
                                    <option value="" disabled selected>Select category</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="fashion">Fashion</option>
                                    <option value="home">Home & Garden</option>
                                    <option value="vehicles">Vehicles</option>
                                    <option value="property">Property</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <!-- Location -->
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Location *
                                </label>
                                <input type="text" 
                                       name="location"
                                       required
                                       placeholder="Where is the item located?"
                                       class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm">
                            </div>
                            
                            <!-- Description -->
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Description *
                                </label>
                                <textarea name="description"
                                          required
                                          rows="4"
                                          placeholder="Describe your item in detail..."
                                          class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm"></textarea>
                            </div>
                            
                            <!-- Image Upload -->
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Item Images *
                                </label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-teal-500 transition-colors">
                                    <div class="flex flex-col items-center justify-center">
                                        <i class="fa-solid fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                                        <p class="text-sm text-gray-600 mb-1">
                                            <span class="font-semibold">Click to upload</span> or drag and drop
                                        </p>
                                        <p class="text-xs text-gray-500">PNG, JPG, JPEG up to 5MB</p>
                                        <input type="file" 
                                               name="image"
                                               required
                                               accept="image/*"
                                               class="hidden"
                                               id="item-image-upload">
                                        <label for="item-image-upload" 
                                               class="mt-3 inline-flex items-center px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors cursor-pointer">
                                            <i class="fa-solid fa-camera mr-2"></i>
                                            Choose Image
                                        </label>
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-2 mt-3" id="image-preview-container">
                                    <!-- Image previews will appear here -->
                                </div>
                            </div>
                            
                            <!-- Contact Info -->
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Contact Information *
                                </label>
                                <input type="tel" 
                                       name="contact"
                                       required
                                       placeholder="Phone number for buyers to contact you"
                                       class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm">
                            </div>
                        </div>
                        
                        <!-- Hidden field for item form -->
                        <input type="hidden" name="item_form" value="true">
                    </form>
                </div>
                
                <!-- Modal footer -->
                <div class="flex items-center p-4 md:p-6 border-t border-gray-200 rounded-b-xl md:rounded-b-2xl space-x-3">
                    <button type="submit" 
                            form="add-item-form"
                            class="flex-1 inline-flex items-center justify-center px-4 py-3 bg-gradient-to-r from-teal-500 to-cyan-500 text-white text-sm font-medium rounded-lg hover:from-teal-600 hover:to-cyan-600 transition-all active:scale-95">
                        <i class="fa-solid fa-cloud-upload-alt mr-2"></i>
                        List Item
                    </button>
                    <button type="button" 
                            data-modal-hide="add-item-modal"
                            class="flex-1 inline-flex items-center justify-center px-4 py-3 border border-gray-300 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-50 transition-colors active:scale-95">
                        <i class="fa-solid fa-times mr-2"></i>
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Filter Modal -->
    <div id="mobile-filter-modal" class="hidden fixed inset-0 bg-black/50 z-50 md:hidden">
        <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-2xl max-h-[80vh] overflow-hidden">
            <!-- Modal Header -->
            <div class="sticky top-0 bg-white border-b border-gray-200 p-4">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900">Filters</h2>
                    <button id="close-filter-modal"
                            class="w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center active:scale-95">
                        <i class="fa-solid fa-times text-gray-600"></i>
                    </button>
                </div>
            </div>
            
            <!-- Modal Content -->
            <div class="p-4 overflow-y-auto space-y-6 max-h-[calc(80vh-70px)]">
                <!-- Search -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fa-solid fa-search text-gray-400"></i>
                        </div>
                        <input type="text" 
                               placeholder="Search items..." 
                               class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                    </div>
                </div>
                
                <!-- Category -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 p-2.5">
                        <option selected>All Categories</option>
                        <option value="electronics">Electronics</option>
                        <option value="fashion">Fashion</option>
                        <option value="home">Home & Garden</option>
                        <option value="vehicles">Vehicles</option>
                    </select>
                </div>
                
                <!-- Price Range -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Price Range</label>
                    <select class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 p-2.5">
                        <option selected>All Prices</option>
                        <option value="0-100">Under GHS 100</option>
                        <option value="100-500">GHS 100 - 500</option>
                        <option value="500-1000">GHS 500 - 1000</option>
                    </select>
                </div>
                
                <!-- Location -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                    <select class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 p-2.5">
                        <option selected>All Locations</option>
                        <option value="accra">Accra</option>
                        <option value="kumasi">Kumasi</option>
                        <option value="tema">Tema</option>
                    </select>
                </div>
                
                <!-- Sort By -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
                    <select class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 p-2.5">
                        <option selected>Newest First</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                    </select>
                </div>
            </div>
            
            <!-- Modal Footer -->
            <div class="sticky bottom-0 bg-white border-t border-gray-200 p-4">
                <div class="flex space-x-3">
                    <button id="apply-filters"
                            class="flex-1 inline-flex items-center justify-center px-4 py-3 bg-gradient-to-r from-teal-500 to-cyan-500 text-white text-sm font-medium rounded-lg hover:from-teal-600 hover:to-cyan-600 transition-all active:scale-95">
                        Apply Filters
                    </button>
                    <button id="reset-filters"
                            class="flex-1 inline-flex items-center justify-center px-4 py-3 border border-gray-300 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-50 transition-colors active:scale-95">
                        Reset
                    </button>
                </div>
            </div>
        </div>
    </div>

    {% include "partials/footer.html" %}

    <!-- Add Flowbite JS for modal functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>

    <script>
        function goBack() {
            window.history.back();
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Wrap form in add-item-form ID for modal submission
            const form = document.querySelector('#add-item-modal form');
            if (form) {
                form.id = 'add-item-form';
            }

            // Image preview functionality
            const imageUpload = document.getElementById('item-image-upload');
            const previewContainer = document.getElementById('image-preview-container');
            
            if (imageUpload && previewContainer) {
                imageUpload.addEventListener('change', function(event) {
                    previewContainer.innerHTML = '';
                    const files = event.target.files;
                    
                    for (let i = 0; i < files.length && i < 3; i++) {
                        const file = files[i];
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            const previewDiv = document.createElement('div');
                            previewDiv.className = 'relative aspect-square rounded-lg overflow-hidden';
                            
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = 'w-full h-full object-cover';
                            img.alt = 'Preview ' + (i + 1);
                            
                            const removeBtn = document.createElement('button');
                            removeBtn.type = 'button';
                            removeBtn.className = 'absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full text-xs flex items-center justify-center';
                            removeBtn.innerHTML = '<i class="fa-solid fa-times"></i>';
                            removeBtn.addEventListener('click', function() {
                                previewDiv.remove();
                                // You might want to handle file removal from input here
                            });
                            
                            previewDiv.appendChild(img);
                            previewDiv.appendChild(removeBtn);
                            previewContainer.appendChild(previewDiv);
                        }
                        
                        reader.readAsDataURL(file);
                    }
                });
            }

            // Mobile Filter Toggle
            const filterToggle = document.getElementById('filter-toggle');
            const filterModal = document.getElementById('mobile-filter-modal');
            const closeFilterBtn = document.getElementById('close-filter-modal');
            const applyFiltersBtn = document.getElementById('apply-filters');
            const resetFiltersBtn = document.getElementById('reset-filters');

            // Toggle filter modal
            if (filterToggle) {
                filterToggle.addEventListener('click', function() {
                    filterModal.classList.remove('hidden');
                });
            }

            // Close filter modal
            if (closeFilterBtn) {
                closeFilterBtn.addEventListener('click', function() {
                    filterModal.classList.add('hidden');
                });
            }

            // Apply filters
            if (applyFiltersBtn) {
                applyFiltersBtn.addEventListener('click', function() {
                    filterModal.classList.add('hidden');
                    // Add your filter application logic here
                });
            }

            // Reset filters
            if (resetFiltersBtn) {
                resetFiltersBtn.addEventListener('click', function() {
                    // Reset all filter inputs
                    const inputs = filterModal.querySelectorAll('input, select');
                    inputs.forEach(input => {
                        if (input.type === 'text') {
                            input.value = '';
                        } else if (input.tagName === 'SELECT') {
                            input.selectedIndex = 0;
                        }
                    });
                });
            }

            // Close modal when clicking outside
            filterModal.addEventListener('click', function(e) {
                if (e.target === filterModal) {
                    filterModal.classList.add('hidden');
                }
            });

            // Add padding to bottom for FAB
            if (window.innerWidth < 768) {
                const mainContent = document.querySelector('main');
                if (mainContent) {
                    mainContent.style.paddingBottom = '80px';
                }
            }

            // Touch swipe to close modal
            let startY = 0;
            const modalContent = filterModal.querySelector('.absolute.bottom-0');

            if (modalContent) {
                modalContent.addEventListener('touchstart', function(e) {
                    startY = e.touches[0].clientY;
                }, { passive: true });

                modalContent.addEventListener('touchmove', function(e) {
                    const currentY = e.touches[0].clientY;
                    const diff = currentY - startY;
                    
                    if (diff > 50) {
                        filterModal.classList.add('hidden');
                    }
                }, { passive: true });
            }
        });
    </script>
    
    <!-- Mobile-First CSS -->
    <style>
        /* Line clamping */
        .line-clamp-1 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 1;
        }
        
        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
        }
        
        /* Better scrolling */
        .overflow-y-auto {
            -webkit-overflow-scrolling: touch;
        }
        
        /* Modal animation */
        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }
        
        #mobile-filter-modal .absolute.bottom-0 {
            animation: slideUp 0.3s ease-out;
        }
        
        /* Touch improvements */
        button, a {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Prevent zoom on iOS inputs */
        @media screen and (max-width: 768px) {
            input, select, textarea {
                font-size: 16px;
            }
        }
        
        /* Image preview styling */
        #image-preview-container img {
            transition: transform 0.3s ease;
        }
        
        #image-preview-container img:hover {
            transform: scale(1.05);
        }
    </style>
{% endblock %}